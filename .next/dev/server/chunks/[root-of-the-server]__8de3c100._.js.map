{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/portfolio/my-portfolio/app/api/contact/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport nodemailer from \"nodemailer\";\r\n\r\n/**\r\n * Expects the request body (JSON) to have:\r\n *  - name (string, required)\r\n *  - email (string, required)\r\n *  - phone (string, optional)\r\n *  - message (string, optional)\r\n */\r\nexport async function POST(req) {\r\n  try {\r\n    const data = await req.json();\r\n\r\n    // Debug environment\r\n    console.log(\"[Contact API] EMAIL_USER exists:\", !!process.env.EMAIL_USER);\r\n    console.log(\"[Contact API] EMAIL_PASS exists:\", !!process.env.EMAIL_PASS);\r\n\r\n    // Validate environment variables\r\n    if (!process.env.EMAIL_USER || !process.env.EMAIL_PASS) {\r\n      console.error(\"[Contact API] EMAIL_USER or EMAIL_PASS missing\");\r\n      return NextResponse.json(\r\n        { success: false, message: \"Email configuration missing\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    // Validate required fields\r\n    if (!data.name || !data.email) {\r\n      return NextResponse.json(\r\n        { success: false, message: \"Name and email are required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Attempt to set up transporter (basic Gmail, fallback SMTP if needed)\r\n    let transporter;\r\n    try {\r\n      transporter = nodemailer.createTransport({\r\n        service: \"gmail\",\r\n        auth: {\r\n          user: process.env.EMAIL_USER,\r\n          pass: process.env.EMAIL_PASS,\r\n        },\r\n        secure: false,\r\n        tls: {\r\n          rejectUnauthorized: false,\r\n        },\r\n      });\r\n      await transporter.verify();\r\n      console.log(\"[Contact API] Gmail direct config success\");\r\n    } catch (gmailError) {\r\n      // Fallback to SMTP config\r\n      try {\r\n        transporter = nodemailer.createTransport({\r\n          host: \"smtp.gmail.com\",\r\n          port: 587,\r\n          secure: false,\r\n          auth: {\r\n            user: process.env.EMAIL_USER,\r\n            pass: process.env.EMAIL_PASS,\r\n          },\r\n          tls: {\r\n            rejectUnauthorized: false,\r\n          },\r\n        });\r\n        await transporter.verify();\r\n        console.log(\"[Contact API] SMTP Gmail config success\");\r\n      } catch (smtpError) {\r\n        console.error(\"[Contact API] All email configs failed\");\r\n        return NextResponse.json(\r\n          { success: false, message: \"Could not set up email service\" },\r\n          { status: 500 }\r\n        );\r\n      }\r\n    }\r\n\r\n    // Create HTML for the email\r\n    const htmlContent = `\r\n      <!DOCTYPE html>\r\n      <html>\r\n      <head>\r\n        <meta charset=\"utf-8\">\r\n        <style>\r\n          body { font-family: Arial, sans-serif; color: #333; }\r\n          .container { max-width: 600px; margin:20px auto; padding:20px; background:#fbfbfb; border-radius:10px; border:1px solid #eee; }\r\n          .header { font-size: 1.5rem; margin-bottom: 14px; color: #fa7c27;}\r\n          .label { font-weight: bold; color: #E87124;}\r\n          .field { margin-bottom: 12px; }\r\n          .msg { white-space: pre-line; background: #fff7ed; padding: 12px; border-radius: 4px;}\r\n          .footer { color:#888; font-size:13px; margin-top:24px;}\r\n        </style>\r\n      </head>\r\n      <body>\r\n        <div class=\"container\">\r\n          <div class=\"header\">ðŸ“¬ New Contact Form Submission</div>\r\n          <div class=\"field\"><span class=\"label\">Name:</span> ${data.name}</div>\r\n          <div class=\"field\"><span class=\"label\">Email:</span> ${data.email}</div>\r\n          ${\r\n            data.phone\r\n              ? `<div class=\"field\"><span class=\"label\">Phone:</span> ${data.phone}</div>`\r\n              : \"\"\r\n          }\r\n          ${\r\n            data.message\r\n              ? `<div class=\"field\"><span class=\"label\">Message:</span>\r\n                 <div class=\"msg\">${data.message.replace(/\\n/g, \"<br/>\")}</div>\r\n                </div>`\r\n              : \"\"\r\n          }\r\n          <div class=\"footer\">Form received at: ${new Date().toLocaleString(\r\n            \"en-IN\",\r\n            {\r\n              timeZone: \"Asia/Kolkata\",\r\n              year: \"numeric\",\r\n              month: \"long\",\r\n              day: \"numeric\",\r\n              hour: \"2-digit\",\r\n              minute: \"2-digit\",\r\n            }\r\n          )}</div>\r\n        </div>\r\n      </body>\r\n      </html>\r\n    `;\r\n\r\n    // Plain-text fallback\r\n    const textContent = `\r\nNew Contact Form Submission\r\n\r\nName: ${data.name}\r\nEmail: ${data.email}\r\n${data.phone ? `Phone: ${data.phone}` : \"\"}\r\n${data.message ? `Message:\\n${data.message}` : \"\"}\r\nReceived At: ${new Date().toLocaleString(\"en-IN\", {\r\n      timeZone: \"Asia/Kolkata\",\r\n      year: \"numeric\",\r\n      month: \"long\",\r\n      day: \"numeric\",\r\n      hour: \"2-digit\",\r\n      minute: \"2-digit\",\r\n    })}\r\n    `;\r\n\r\n    const mailOptions = {\r\n      from: `\"Portfolio Contact\" <${process.env.EMAIL_USER}>`,\r\n      to: process.env.EMAIL_USER,\r\n      subject: `Contact Form: ${data.name} (${data.email})`,\r\n      text: textContent,\r\n      html: htmlContent,\r\n    };\r\n\r\n    const result = await transporter.sendMail(mailOptions);\r\n    console.log(\"[Contact API] Email sent:\", result.messageId);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      message: \"Your message was sent successfully!\",\r\n      messageId: result.messageId,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"[Contact API] Error sending email:\", error);\r\n\r\n    let errorMessage = \"Could not send your message. Please try again.\";\r\n    if (error && typeof error === \"object\" && \"code\" in error) {\r\n      if (error.code === \"EAUTH\") {\r\n        errorMessage = \"Email authentication failed. Please check configuration.\";\r\n      } else if (error.code === \"ECONNECTION\") {\r\n        errorMessage = \"Connection to email server failed.\";\r\n      } else if (error.code === \"ETIMEDOUT\") {\r\n        errorMessage = \"Email sending timed out.\";\r\n      }\r\n    }\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        message: errorMessage,\r\n        error: process.env.NODE_ENV === \"development\" && error instanceof Error ? error.message : undefined,\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}